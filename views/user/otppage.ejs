
<div class="bg-pink-50 font-sans">
  <!-- Navbar -->
  <%- include ('header') %>
  <%- include('alert') %>

  <!-- OTP Section -->
<main class="flex justify-center items-center min-h-[60vh] px-4">
  <div class="bg-pink-100 p-6 rounded-lg shadow-lg max-w-md w-full">
    <h2 class="text-xl font-semibold text-center text-pink-700 mb-4">Enter the OTP</h2>
    <form class="space-y-4" action="/otp" method="post">
      <div class="flex justify-center space-x-3">
        <% for (let i = 1; i <= 4; i++) { %>
          <input
            type="text"
            minlength="1"
            maxlength="1"
            name="otp<%= i %>"
            class=" otp-input w-12 h-12 border border-gray-300 rounded-md text-center text-lg focus:outline-none focus:ring-2 focus:ring-pink-500"
            autocomplete="off"
          />
        <% } %>
      </div>
      <input type="hidden" name="otp" id="otp">
      <input type="hidden" name="otpTime" value="<%= otpTime %>" id="otpTime">

      <div id="otpTimer"></div>
      <button
        type="submit"
        id="verify-btn"
        class="w-full bg-black text-white py-2 rounded-md hover:bg-gray-800"
      >
        Submit
      </button>
    </form>
    <p class="text-center text-gray-700 mt-4">
      Didnâ€™t get the OTP? <a href="/resendotp" class="text-pink-700 hover:underline" id="resend-btn">Resend</a>
    </p>
  </div>
</main>


  <!-- Footer -->
  <%- include ('footer') %>

</div>

<script>
  const otpInputs = document.querySelectorAll('.otp-input');
  const hiddenOtpInput = document.getElementById('otp');
  const otpTimer = document.getElementById('otpTimer');
  const otpTime = parseInt(document.getElementById('otpTime').value);
  const duration = 60 * 2 * 1000;
  const verifybtn = document.getElementById('verify-btn');
  const resendbtn = document.getElementById('resend-btn');



  //-----------Go to next input on otp--------------------


  otpInputs.forEach((input,index)=>{
    input.addEventListener('input',()=>{
      if(input.value.length === input.maxlength){
        const nextInput = otpInputs[index+1];
        if(nextInput){
          nextInput.focus();
        }
      }

      updateHiddenOtpInput();

    });

    //--------------Got to previous input on otp----------------


    input.addEventListener('keydown',(event)=>{
      if(event.key === 'Backspace' && input.value.length === 0){
        const prevInput = otpInputs[index-1];
        if(prevInput){
          prevInput.focus();
        }
      }
    });
  });

  function updateHiddenOtpInput(){

    let otpValue = '';
    otpInputs.forEach((input)=>{
      otpValue += input.value;

    });

    hiddenOtpInput.value = otpValue;
  }

  // -------------------Timer for OTP--------------------

  function countDown(){
    const interval = setInterval(()=>{
      const now = Date.now();
      let remain = duration - (now - otpTime);

      if(remain <=0){
        otpTimer.remove();
        verifybtn.disabled = true;
        clearInterval(interval);

      } else {
        const min = Math.floor((remain % (1000 * 60 * 60)) / (1000 * 60));
        const sec = Math.floor((remain % (1000 * 60)) / 1000);
        otpTimer.innerHTML = `Time remaining: ${min}:${sec < 10 ? '0' : ''}${sec}`;
      }
    }, 1000);
  }

  countDown();

</script>
</html>
